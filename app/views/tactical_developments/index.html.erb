<div class="mx-auto w-full mt-10 px-4">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-600 font-medium rounded-lg inline-block"><%= notice %></p>
  <% end %>

  <div class="flex flex-wrap items-start justify-between gap-3 mb-6">
    <div>
      <h1 class="text-3xl font-bold text-stone-900 dark:text-stone-100">Desarrollo táctico</h1>
      <p class="text-gray-600 dark:text-gray-300"><strong>Alumno:</strong> <%= @athlete_card.name %></p>
      <p class="text-gray-600 dark:text-gray-300"><strong>Escuela:</strong> <%= @school.name %></p>
    </div>

    <div class="flex gap-2">
      <%= link_to "Nueva evaluación", new_school_athlete_card_tactical_development_path(@school, @athlete_card), class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" %>
      <%= link_to "Volver a cartilla", school_athlete_card_path(@school, @athlete_card), class: "px-4 py-2 bg-gray-200 dark:bg-stone-700 text-gray-900 dark:text-stone-100 rounded hover:bg-gray-300 dark:hover:bg-stone-600" %>
    </div>
  </div>

  <div class="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-lg p-4 mb-6">
    <h2 class="text-xl font-semibold mb-3 text-stone-900 dark:text-stone-100">Tendencia de avance táctico (promedio)</h2>
    <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Escala: Insuficiente (0), Regular (1), Bien (2).</p>
    <%= tactical_progress_chart(@tactical_developments) %>
  </div>

  <% if @tactical_developments.any? %>
    <div class="space-y-4">
      <% @tactical_developments.each_with_index do |evaluation, index| %>
        <% previous = index.zero? ? nil : @tactical_developments[index - 1] %>
        <div class="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-lg p-4">
          <div class="flex flex-wrap items-start justify-between gap-3 mb-4">
            <div class="text-stone-900 dark:text-stone-100">
              <p><strong>Fecha:</strong> <%= evaluation.evaluated_on.strftime("%d/%m/%Y") %></p>
              <p><strong>Equipo:</strong> <%= evaluation.team.name %></p>
              <p><strong>Categoría:</strong> <%= evaluation.category.name %></p>
            </div>

            <div class="text-stone-900 dark:text-stone-100 text-sm">
              <p><strong>Promedio:</strong> <%= number_with_precision(evaluation.overall_score, precision: 2) %></p>
              <p><strong>Tendencia:</strong> <%= tactical_trend_badge(evaluation.overall_score, previous&.overall_score) %></p>
            </div>

            <div class="flex gap-2">
              <%= link_to "Editar", edit_school_athlete_card_tactical_development_path(@school, @athlete_card, evaluation), class: "px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700" %>
              <%= button_to "Eliminar", school_athlete_card_tactical_development_path(@school, @athlete_card, evaluation), method: :delete, form: { data: { turbo_confirm: "¿Eliminar esta evaluación?" } }, class: "px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700" %>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
            <% TacticalDevelopment::SKILL_FIELDS.each do |skill| %>
              <div class="border border-gray-200 dark:border-stone-700 rounded p-2 bg-gray-50 dark:bg-stone-700">
                <p class="text-xs text-gray-600 dark:text-gray-300"><%= tactical_skill_label(skill) %></p>
                <p class="text-sm font-semibold text-stone-900 dark:text-stone-100"><%= tactical_rating_label(evaluation.public_send(skill)) %></p>
              </div>
            <% end %>
          </div>

          <% if evaluation.notes.present? %>
            <div class="mt-3 text-stone-900 dark:text-stone-100">
              <p><strong>Observaciones:</strong> <%= evaluation.notes %></p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-lg p-6">
      <p class="text-stone-900 dark:text-stone-100">Aún no hay evaluaciones tácticas registradas para este alumno.</p>
    </div>
  <% end %>
</div>
